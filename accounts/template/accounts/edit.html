{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}


{% block title %} Edit profile {% endblock %}

{% block header %} Edit profile {% endblock %}

{% block content %}
    <div class="d-flex align-items-center mt-4 mb-5">
        <a href="{% url 'accounts:your_profile' %}{% if request.GET.source %}?source={{ request.GET.source }}{% endif %}">
            <img src="/media/icons/back.png" alt="back" class="me-3 back-arrow"></a>
        <h1>{% if user == account.username %}Edit your profile{% else %}Edit {{ account.username }}'s profile{% endif %}</h1>
    </div>

    <div class="d-flex position-relative" style="flex-grow: 1">
        <div class="d-flex flex-column align-items-center me-5">
            <div class="position-relative">
                <button type="button" onclick="document.getElementById('browse').click()"
                        class="position-absolute rounded-circle browse-files">
                    <img src="/media/icons/edit.png" alt="Edit profile picture" title="Edit profile picture" id="edit-pfp">
                </button>
                <img src="{% if account.profile_picture %}{{ account.profile_picture.url }}
                    {% else %}/media/pfps/default.png{% endif %}"
                 alt="Profile picture" style="height: 300px; aspect-ratio: 1; width: 300px; border: 3px var(--banner-color) solid;"
                 class="rounded-circle mb-3" id="pfp"></div>
            <button type="button" style="border: 0; padding: 0; color: var(--banner-color); max-width: fit-content; background: transparent; font-weight: 600"
                    class="fst-italic fs-4 mb-5" id="remove-pfp">Remove profile picture</button>
            <a href="{% url 'accounts:change_password' %}{% if request.GET.source %}?source={{ request.GET.source }}{% endif %}"
               class="fs-4 fst-italic" style="color: var(--banner-color); text-decoration: none; font-weight: 600">
                Change password</a>
        </div>

    <form method="post" class="d-flex flex-column justify-content-start" style="flex-grow: 1;"  enctype="multipart/form-data" id="edit-form">
        {% csrf_token %}
        <div class="d-flex align-items-center mb-4">
            <img src="/media/icons/id-card.png" alt="Name" title="Name" class="black-to-banner-color me-3"
                 style="width: 30px; height: 30px">
            <div class="form-floating me-auto" style="flex-grow: 0.48">
                {% render_field form.first_name placeholder="First name" class+="form-control form-field me-3" id="first_name" %}
                <label for="first-name">First name</label>
            </div>
            <div class="form-floating ms-auto" style="flex-grow: 0.48">
                {% render_field form.last_name placeholder="Last name" class+="form-control form-field me-3" id="last_name" %}
                <label for="last-name">Last name</label>
            </div>
        </div>
        <div  class="d-flex align-items-center mb-4">
            <img src="/media/icons/user.png" alt="Username" title="Username" style="height: 30px; width: 30px"
                 class="black-to-banner-color me-3">
            <div class="form-floating"  style="flex-grow: 1">
                {% render_field form.username placeholder="Username" class+="form-control form-field" id="username" %}
                <label for="username">Username</label>
            </div>
        </div>
        <div  class="d-flex align-items-center mb-4">
            <img src="/media/icons/arroba-sign.png" alt="Email" title="Email" style="width: 30px; height: 30px"
                 class="black-to-banner-color me-3">
            <div class="form-floating"  style="flex-grow: 1">
                {% render_field form.email placeholder="Email" class+="form-control form-field" id="email" %}
                <label for="email">Email</label>
            </div>
        </div>
        <div  class="d-flex align-items-center mb-4">
            <img src="/media/icons/cake.png" alt="Birthday" title="Birthday"
                 class="black-to-banner-color me-3"
                 style="width: 30px; height: 30px">
            <div class="form-floating"  style="flex-grow: 1">
                {% render_field form.birthday placeholder="Birthday" class+="form-control form-field" id="birthday" %}
                <label for="birthday">Birthday</label>
            </div>
        </div>
        <div  class="d-flex align-items-start mb-4">
            <img src="/media/icons/profile.png" alt="Bio" title="Bio" class="black-to-banner-color me-3"
                 style="width: 30px; height: 30px;">
            <div class="form-floating"  style="flex-grow: 1">
                {% render_field form.bio placeholder="Bio" class+="form-control form-field" id="bio" style="height: auto" %}
                <label for="bio">Bio</label>
            </div>
        </div>
        {% render_field form.profile_picture id="browse" class="d-none" %}
        <input type="submit" name="confirmed" value="Save" class="submit rounded-pill mb-4">
    </form>
    </div>

    <script>
    button = document.getElementById('remove-pfp')
    clearButton = document.getElementById('profile_picture-clear_id')
    pfp = document.getElementById('pfp')
    pfpLink = document.getElementById('pfp').src
    browse = document.getElementById('browse')
    datePicker = document.getElementById('birthday')

    browse.addEventListener('change', () => {
        let reader = new FileReader()
        reader.onload = (e) => {
            pfp.src = e.target.result
        }
        reader.readAsDataURL(browse.files[0])
        clearButton.checked = false
    })

    button.addEventListener('click', () => {
        if (button.textContent === 'Remove profile picture') {
            clearButton.checked = true
            button.textContent = 'Restore profile picture'
            pfp.src = '/media/pfps/default.png'
        } else {
            browse.value = null
            clearButton.checked = false
            button.textContent = 'Remove profile picture'
            pfp.src = pfpLink
        }
    })

    datePicker.addEventListener('click', () => {
        datePicker.showPicker()
    })

    </script>
{% endblock %}